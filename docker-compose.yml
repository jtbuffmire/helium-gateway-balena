# Docker Compose for Helium Gateway with RAK2287 
version: '2'

services:
  cs-mux:
    build: ./cs-mux
    restart: unless-stopped
    # ports: ["9090:9090"]      # To later activate Prometheus metrics

  udp-packet-forwarder:
    image: rakwireless/udp-packet-forwarder:latest
    restart: unless-stopped
    privileged: true
    environment:
      MODEL: "RAK2287"  
      CONCENTRATOR: "SX1302"
      INTERFACE: "SPI"
      HAS_GPS: 0
      HAS_LTE: 0
      RESET_GPIO: 15
      POWER_EN_GPIO: 23
      RADIO_DEV: "/dev/spidev0.0"
      # GATEWAY_EUI: ""
      BAND: "us_902_928"
      SERVER_HOST: "cs-mux"
      SERVER_PORT: 1700
      GPS_LATITUDE: 38.851137
      GPS_LONGITUDE: -121.269953
      GPS_ALTITUDE: 0
    depends_on:
      - cs-mux

  gateway-rs:
    image: quay.io/team-helium/miner:gateway-latest
    restart: unless-stopped
    devices:
      - /dev/i2c-1:/dev/i2c-1 
    environment:
      - GW_REGION=US915
      - GW_LISTEN=0.0.0.0:1680
      - GW_API=0.0.0.0:4467
      - GW_KEYPAIR=ecc://i2c-1:96?slot=0
      - GW_ONBOARDING=ecc://i2c-1:96?slot=15
      - REGION_OVERRIDE=${REGION_OVERRIDE:-US915}
    depends_on:
      - cs-mux